!function($,window,document,undefined){function reBindEvent(t,a){t.off("focus","input"),t.off("blur","input"),+[1]?t.off("input","input"):t.find("input").off("propertychange"),t.off("keyup","input"),t.off("click","i"),t.on("focus","input",{options:a},focusSearchInput),t.on("blur","input",{options:a},blurSearchInput),+[1]?t.on("input","input",{options:a},inputSearchInput):t.find("input").on("propertychange",{options:a},inputSearchInput),t.on("keyup","input",{options:a},keyUpSearhInput),t.on("click","i",{options:a},closeSearchList)}function getQueryList(queryObj,options){var dataStr=options.ajaxKey+"="+encodeURIComponent($.trim(queryObj.val()));options.parameters&&(dataStr+=initParameters(options.parameters)),$.ajax({url:options.ajaxUrl,data:dataStr,success:function(data){var obj=data;"object"!=typeof data&&(obj=eval(data)),initQueryList(queryObj,obj,options)},error:function(t){console.log(t)}})}function initParameters(t){var a="";for(var e in t)a=a+"&"+encodeURIComponent(e)+"="+encodeURIComponent(t[e]);return a}function initQueryList(t,a,e){var n=e.returnTxtKey,i=(e.returnIDKey,$(dataListClass).empty());if(a){var s=a.length;if(s>0)for(var r=0;s>r;r++)i.append("<li>"+a[r][n]+"</li>"),i.find("li:last").data("dataObj",a[r]),i.find("li:last").on("click",{options:e},clickSearchLi);else i.append("<li>搜索不到该数据……</li>"),i.find("li:last").addClass("disable")}else i.append("<li>搜索不到该数据……</li>"),i.find("li:last").addClass("disable");var o={};o.width=t.parent().width(),o.top=t.parent().offset().top+t.parent().height()+2+"px",o.left=t.parent().offset().left+"px",i.css(o),i.is(":hidden")&&i.slideDown("200").scrollTop(0)}function focusSearchInput(t){var a=t.data.options;a.initFn&&a.initFn(),isClick=!1;var e=$(t.target);$(".tcSearchWrapper.focus").removeClass("focus"),e.parent().addClass("focus"),$(".tcSearchWrapper.currentInput").removeClass("currentInput"),e.parent().addClass("currentInput"),""!==$.trim(e.val())?""!==a.ajaxUrl&&getQueryList(e,a):$(dataListClass).slideUp(200)}function blurSearchInput(t){var a=$(t.target);if(a.parent().removeClass("focus"),""!==$.trim(a.val()))a.parent().removeClass("noTxt").addClass("hasTxt");else{a.parent().removeClass("hasTxt").addClass("noTxt"),a.val("").data("dataObj",""),a.parent().prev().val("").data("dataObj","");var e=t.data.options;e.clearFn&&e.clearFn(a.data("dataObj"))}a.siblings("ul").slideUp("200")}function keyUpSearhInput(t){var a=($(t.target),$(dataListClass)),e=a.find("li.active");"13"==t.keyCode?e.length>0&&e.click():"38"==t.keyCode?e.length>0&&(a.find("li:first").hasClass("active")?e.removeClass("active"):a.find("li:eq(1)").hasClass("active")?(e.removeClass("active").prev().addClass("active"),a.scrollTop(0)):(e.removeClass("active").prev().addClass("active"),e=a.find("li.active"),e.position().top<0&&a.scrollTop(a.scrollTop()-e.prev().outerHeight()))):"40"==t.keyCode&&(0===e.length?a.find("li:first").addClass("active"):(a.find("li:last").hasClass("active")||e.removeClass("active").next().addClass("active"),e=a.find("li.active"),e.position().top>=186-e.height()&&a.scrollTop(a.scrollTop()+e.outerHeight())))}function inputSearchInput(t){var a=$(t.target),e=t.data.options;if(!isClick)if($.trim(a.val()).length<e.minCharacters){var n=$.trim(a.val());a.parent().prev().val(n).data("dataObj","")}else{var n=$.trim(a.val()),i=a.data("dataObj");a.parent().prev().val(n).data("dataObj","");setTimeout(function(){$.trim(a.val())===n&&(""!==$.trim(a.val())?(a.parent().removeClass("noTxt").addClass("hasTxt"),getQueryList(a,e)):(a.parent().removeClass("hasTxt").addClass("noTxt"),e.clearFn&&e.clearFn(i)))},500)}}function clickSearchLi(t){if("li"==t.target.tagName.toLowerCase()){isClick=!0;var a=$(t.target);if(!a.hasClass("disable")){var e=a.text(),n=a.data("dataObj"),i=a.parent(),s=$(".tcSearchWrapper.currentInput input");s.val(e).data("dataObj",n).attr("data-selected",!0).blur(),s.parent().prev().val(e).data("dataObj",n),i.slideUp("200",function(){i.empty()}),t.data.options.fn&&t.data.options.fn(n)}}}function closeSearchList(t){if(isClick=!0,"i"==t.target.tagName.toLowerCase()){$(dataListClass).slideUp(200);var a=$(t.target),e=a.siblings("input"),n=e.data("dataObj"),i=$.trim(e.val());e.val("").data("dataObj","").attr("data-selected",!1).blur(),e.parent().prev().val("").data("dataObj",""),isClick=!1,a.parent().removeClass("hasTxt").addClass("noTxt"),t.data.options.clearFn&&t.data.options.clearFn(n,i)}}var isClick=!1,dataListClass=".TC-autocomplete-search-list",SearchWrapper=function(t,a){this.$element=t,this.defaults={placeHolder:"",ajaxUrl:"",ajaxKey:"",minCharacters:1,parameters:null,returnTxtKey:"dataName",returnIDKey:"dataID",defaultTxt:"",defaultObj:{},initFn:null,fn:null,clearFn:null},this.options=$.extend({},this.defaults,a)};SearchWrapper.prototype={initDOM:function(){var t='<div class="tcSearchWrapper noTxt">                            <input type="text" placeholder="'+this.options.placeHolder+'" data-selected=false>                            <i class="icon-close"></i>                        </div>',a=this.options;0==$(".TC-autocomplete-search-list").length&&($("body").append("<ul class='TC-autocomplete-search-list'></ul>"),$(document).click(function(t){var a=$(t.target);0==a.parents(".tcSearchWrapper").length&&$(dataListClass).slideUp(200)})),this.$element.each(function(){var e=$(t);$(this).after(e);var n=$(this).next();n.find("input").css({"line-height":n.height()+"px"}),a.defaultTxt.length&&(n.find("input").val(a.defaultTxt).data("dataObj",a.defaultObj),n.prev().val(a.defaultTxt).data("dataObj",a.defaultObj)),n.find("i").css({"line-height":n.height()+"px"}),$(this).hide()})},bindEvent:function(){var t=this.options;this.$element.each(function(){var a=$(this).next();a.on("focus","input",{options:t},focusSearchInput),a.on("blur","input",{options:t},blurSearchInput),+[1]?a.on("input","input",{options:t},inputSearchInput):a.find("input").on("propertychange",{options:t},inputSearchInput),a.on("keyup","input",{options:t},keyUpSearhInput),a.on("click","i",{options:t},closeSearchList)})},setDefaultValue:function(t,a){this.$element.each(function(){var e=$(this).next();$(this).val(t).data("dataObj",a),e.find("input").val(t).data("dataObj",a),t.length&&e.removeClass("noTxt").addClass("hasTxt")})},setOtherParameters:function(t){var a=this.options;this.options=$.extend({},a,{parameters:t});var e=this.options;this.$element.each(function(){var t=$(this).next();reBindEvent(t,e)})},clearInput:function(){this.$element.each(function(){$(this).val("").data("dataObj","");var t=$(this).next();t.removeClass("hasTxt").addClass("noTxt"),t.find("input").val("").data("dataObj","")}),this.options.clearFn&&this.options.clearFn()}},$.fn.tcAutoComplate=function(t){var a=new SearchWrapper(this,t);return a.initDOM(),a.bindEvent(),a}}(jQuery,window,document);